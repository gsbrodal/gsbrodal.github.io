<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Project II - Portfolio optimization</title>
<link rel=stylesheet href="ipsa.css">
</head>
<body>
<h1>Project II - Portfolio optimization</h1>
<p><a href="portfolio.png" target="_blank"><img src="portfolio.png" width="40%" class="right"></a></p>
<p>We consider the problem of choosing a <em>long term</em> stock portfolio, given a set of stocks and their price over some period under <em>risk aversion parameter</em> &gamma;&nbsp;&gt;&nbsp;0.</p>
<p>Assume there are <em>m</em> stocks to be considered.
The portfolio will be represented by a column vector <em>w</em> &in; &#8477;<sup><em>m</em></sup>,
such that &sum;<sub><em>i</em>=1..<em>m</em></sub> <em>w</em><sub><em>i</em></sub> = 1.
If <em>w</em><sub><em>i</em></sub>&nbsp;&gt;&nbsp;0,
you use a fraction <em>w</em><sub><em>i</em></sub> of your total money to buy
the <em>i</em>'th stock, while <em>w</em><sub><em>i</em></sub>&nbsp;&lt;&nbsp;0
represent <a href="https://en.wikipedia.org/wiki/Short_(finance)" target="_blank">shorting</a> that stock.
In both cases we assume the stock is bought/shorted for the entire period.</p>
<p>Let <em>p</em><sub><em>j</em>,<em>i</em></sub> represent the price of the <em>i</em>'th stock at time step <em>j</em>.
If there are <em>n</em>&nbsp;+&nbsp;1 time steps, then <em>p</em>&nbsp;&in;&nbsp;&#8477;<sup>(<em>n</em>+1)&times;<em>m</em></sup> is a matrix.</p>
<p>We let <em>r</em> &in; &#8477;<sup><em>n</em>&times;<em>m</em></sup> be  the matrix, where <em>r</em><sub><em>j</em>,<em>i</em></sub> represents the fractional reward of stock <em>i</em> at time step <em>j</em>, i.e. <em>r</em><sub><em>j</em>,<em>i</em></sub> = (<em>p</em><sub><em>j</em>+1,<em>i</em></sub>&nbsp;&minus;&nbsp;<em>p</em><sub><em>j</em>,<em>i</em></sub>)&nbsp;/&nbsp;<em>p</em><sub><em>j</em>,<em>i</em></sub> for 1&nbsp;&le;&nbsp;<em>j</em>&nbsp;&le;&nbsp;<em>n</em>.</p>
<p>By <em>r</em><sub><em>j</em></sub> we denote the <em>j</em>'th row of <em>r</em>, viewed as a <em>column vector</em> (<em>r</em><sub><em>j</em>,1</sub>, ..., <em>r</em><sub><em>j</em>,<em>m</em></sub>).</p>
<p>We make the (unrealistic) assumption that we can model <em>r</em> by a <em>random variable</em>, distributed as a multivariate Gaussian, with <em>estimated</em> means</p>
<blockquote>
<p>&mu; &#8771; 1/<em>n</em> &middot; &sum;<sub><em>j</em>=1..<em>n</em></sub> <em>r</em><sub><em>j</em></sub></p>
</blockquote>
<p>and <em>estimated covariance matrix</em></p>
<blockquote>
<p>&Sigma;&nbsp;&#8771;&nbsp;1&nbsp;/&nbsp;<em>n</em>&nbsp;&middot;&nbsp;&sum;<sub><em>j</em>=1..<em>n</em></sub> [(<em>r</em><sub><em>j</em></sub> &minus; &mu;)(<em>r</em><sub><em>j</em></sub> &minus; &mu;)<sup><em>T</em></sup>]</p>
</blockquote>
<p>Note that &mu;<sub><em>i</em></sub> and &Sigma;<sub><em>i</em>,<em>i</em></sub> are the estimated mean and variance for stock <em>i</em>.</p>
<p>The distribution of <em>returns</em> using some <em>w</em> is then</p>
<blockquote>
<p><em>R</em><sub><em>w</em></sub> = <em>N</em>(&mu;<sub><em>w</em></sub>, &sigma;<sub><em>w</em></sub><sup>2</sup>)</p>
<p>&mu;<sub><em>w</em></sub> = <em>w</em><sup><em>T</em></sup>&mu;</p>
<p>&sigma;<sub><em>w</em></sub><sup>2</sup> = <em>w</em><sup>T</sup>&Sigma;<em>w</em></p>
</blockquote>
<p>Now, we want to maximize for a balance between high return &mu;<sub><em>w</em></sub> and low risk &sigma;<sub><em>w</em></sub><sup>2</sup>.
This leads to the following optimization problem, where we want to find the value <em>w*</em> of <em>w</em> maximizing the following expresion:</p>
<blockquote>
<p>maximize&nbsp;&nbsp;&nbsp;&nbsp; <em>w</em><sup><em>T</em></sup>&mu; &minus; &gamma;<em>w</em><sup><em>T</em></sup>&Sigma;<em>w</em></p>
<p>subject to&nbsp;&nbsp;&nbsp;&nbsp; &sum;<sub><em>i</em>=1..<em>m</em></sub> <em>w</em><sub><em>i</em></sub> = 1</p>
</blockquote>
<p>where &gamma; controls the balance between risk and return. A high value of &gamma; indicate we are willing to take low risk and vise versa.</p>
<p>In this project you should find <em>w</em>* for different values of &gamma; and using real stock values of your choice. The project consists of the following three questions.</p>
<ol>
<li>
<p>We need a module for collecting stock values. For this you can use the module <a href="https://pandas-datareader.readthedocs.io/en/latest" target="_blank"><code>pandas-datareader</code></a>.
Using this you should write a function <code>get_prices([stock</code><sub><code>1</code></sub><code>, ..., stock</code><sub><code>k</code></sub><code>], step_size, period)</code> that returns a tuple <code>(stocks, p)</code>, where <code>p[j, i]</code> represents the opening price of stock <code>i</code> at time step <code>j</code> and <code>stocks[i]</code> is the name of the <code>i</code>'th stock (adjust the arguments to <code>get_prices</code> to the data available at your data source). Make a plot of <em>p</em>, where each stock is labeled with its name, e.g.  MSFT or GOGL. You should use at least five stocks.</p>
</li>
<li>
<p>Calculate <em>r</em>, &mu; and &Sigma; using the formulas above and the <em>p</em> calculated in the first question. Plot the probability density function (<em>pdf</em>) of the return of each stock.
<br>
<em>Hint</em>. The method <code>norm.pdf</code> from the module <code>scipy.stats</code> might become convenient.</p>
</li>
<li>
<p>Solve the optimization problem defined above for different values of &gamma;, e.g. <code>gammas = (np.arange(10) / 5) + 1</code>, and plot the <em>pdf</em> of each solution to a single plot with appropriate legends. Finally create a scatter plot of how <em>w</em>* changes as &gamma; changes. For each value of &gamma; plot the fraction of
each stock in the portfolio.</p>
</li>
</ol>
</body>
</html>
